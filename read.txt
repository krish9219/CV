@echo off
setlocal enabledelayedexpansion

:: Ask user for the full path to install (e.g., C:\Users\dynamic_sso\OneDrive - Synchrony Financial\Desktop)
echo Please enter the full folder path where you want to install the environment:
set /p userPath=

:: Validate if path exists
if not exist "%userPath%" (
    echo The path "%userPath%" does not exist.
    echo Please check and run the script again.
    pause
    exit /b
)

:: Create 'Python Projects\Virtual Env' directory structure
set targetFolder=%userPath%\Python Projects\Virtual Env
mkdir "%targetFolder%" >nul 2>&1

:: Change to that directory
cd /d "%targetFolder%"

:: Create virtual environment
echo Creating virtual environment...
python -m venv env

:: Activate virtual environment
echo Activating virtual environment...
call env\Scripts\activate

:: Create requirements.txt
echo Generating requirements.txt...
(
echo flask
echo pandas
echo numpy
echo pyodbc
echo paramiko
echo pymssql
echo scikit-learn
) > requirements.txt

:: Install packages using your orgâ€™s proxy-safe pip command
echo Installing packages...
python -m pip install --trusted-host files.pythonhosted.org --trusted-host pypi.org --trusted-host pypi.python.org -r requirements.txt

:: Check if install was successful
if errorlevel 1 (
    echo Installation failed. Keeping requirements.txt for debugging.
    pause
    exit /b
)

:: Delete requirements.txt
echo Cleaning up...
del requirements.txt

echo All done! Your environment is ready.
pause